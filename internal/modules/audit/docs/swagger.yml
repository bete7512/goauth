openapi: 3.0.0
info:
  title: GoAuth Audit Module API
  version: 1.0.0
  description: Audit logging module for tracking system activity and user actions

servers:
  - url: /

tags:
  - name: Audit Logs
    description: User self-service audit log endpoints
  - name: Audit Logs
    description: Audit Logs log management endpoints

paths:
  /me/audit:
    get:
      tags:
        - User Audit
      summary: Get my audit logs
      description: Retrieve audit logs for the current user (both as actor and target)
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/Limit'
        - $ref: '#/components/parameters/Offset'
        - $ref: '#/components/parameters/SortField'
        - $ref: '#/components/parameters/SortDir'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuditLogListResponse'
        '401':
          description: Unauthorized - authentication required

  /me/audit/logins:
    get:
      tags:
        - Audit Logs
      summary: Get my login history
      description: Retrieve login history for the current user
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/Limit'
        - $ref: '#/components/parameters/Offset'
        - $ref: '#/components/parameters/SortField'
        - $ref: '#/components/parameters/SortDir'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuditLogListResponse'
        '401':
          description: Unauthorized

  /me/audit/changes:
    get:
      tags:
        - Audit Logs
      summary: Get my profile changes
      description: Retrieve profile change history for the current user
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/Limit'
        - $ref: '#/components/parameters/Offset'
        - $ref: '#/components/parameters/SortField'
        - $ref: '#/components/parameters/SortDir'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuditLogListResponse'

  /me/audit/security:
    get:
      tags:
        - Audit Logs
      summary: Get my security events
      description: Retrieve security-related events for the current user
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/Limit'
        - $ref: '#/components/parameters/Offset'
        - $ref: '#/components/parameters/SortField'
        - $ref: '#/components/parameters/SortDir'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuditLogListResponse'

  /admin/audit:
    get:
      tags:
        - Audit Logs
      summary: List all audit logs
      description: Retrieve all audit logs (admin only)
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/Limit'
        - $ref: '#/components/parameters/Offset'
        - $ref: '#/components/parameters/SortField'
        - $ref: '#/components/parameters/SortDir'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuditLogListResponse'
        '403':
          description: Forbidden - super admin access required

  /admin/audit/users/{id}:
    get:
      tags:
        - Audit Logs
      summary: Get user audit logs
      description: Retrieve audit logs for a specific user (admin only)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: User ID
        - $ref: '#/components/parameters/Limit'
        - $ref: '#/components/parameters/Offset'
        - $ref: '#/components/parameters/SortField'
        - $ref: '#/components/parameters/SortDir'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuditLogListResponse'
        '403':
          description: Forbidden - super admin access required

  /admin/audit/actions/{action}:
    get:
      tags:
        - Audit Logs
      summary: Get audit logs by action
      description: Retrieve audit logs filtered by action type (admin only)
      security:
        - BearerAuth: []
      parameters:
        - name: action
          in: path
          required: true
          schema:
            type: string
          description: Action type (e.g., "auth.login.success", "admin.user.delete")
          example: "auth.login.success"
        - $ref: '#/components/parameters/Limit'
        - $ref: '#/components/parameters/Offset'
        - $ref: '#/components/parameters/SortField'
        - $ref: '#/components/parameters/SortDir'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuditLogListResponse'
        '403':
          description: Forbidden - super admin access required

components:
  parameters:
    Limit:
      name: limit
      in: query
      schema:
        type: integer
        default: 20
        maximum: 100
      description: Maximum number of items to return
    Offset:
      name: offset
      in: query
      schema:
        type: integer
        default: 0
        minimum: 0
      description: Number of items to skip
    SortField:
      name: sort_field
      in: query
      schema:
        type: string
        default: created_at
        enum: [created_at, action, severity, actor_id]
      description: Field to sort results by
    SortDir:
      name: sort_dir
      in: query
      schema:
        type: string
        default: desc
        enum: [asc, desc]
      description: Sort direction

  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    AuditLogListResponse:
      type: object
      properties:
        data:
          type: object
          properties:
            list:
              type: array
              items:
                $ref: '#/components/schemas/AuditLog'
            sort_field:
              type: string
              example: created_at
            sort_dir:
              type: string
              enum: [asc, desc]
              example: desc
            total:
              type: integer
        message:
          type: string
          nullable: true

    AuditLog:
      type: object
      properties:
        id:
          type: string
          format: uuid
        action:
          type: string
          description: Action type
          example: "auth.login.success"
        actor_id:
          type: string
          format: uuid
          description: User who performed the action
        actor_type:
          type: string
          enum: [user, admin, system]
          default: user
        target_id:
          type: string
          format: uuid
          nullable: true
          description: Resource affected by the action
        target_type:
          type: string
          nullable: true
          description: Type of resource affected
          example: "user"
        organization_id:
          type: string
          format: uuid
          nullable: true
          description: Organization context (future use)
        details:
          type: string
          description: Human-readable description
        metadata:
          type: string
          description: JSON metadata
          example: '{"ip": "192.168.1.1", "user_agent": "Mozilla/5.0..."}'
        severity:
          type: string
          enum: [info, warning, critical]
          default: info
        ip_address:
          type: string
          example: "192.168.1.1"
        user_agent:
          type: string
          example: "Mozilla/5.0 (Windows NT 10.0; Win64; x64)..."
        created_at:
          type: string
          format: date-time
      required:
        - id
        - action
        - actor_id
        - created_at
